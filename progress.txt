[2026-01-22] Phase 1, Task 1: Fixed snowflake calculation to use BigInt instead of number
- Modified: apps/controller/src/utils/messages.ts:40-42
- Changed from ((timestamp - 1420070400000) * 4194304).toString() to ((BigInt(timestamp) - 1420070400000n) << 22n).toString()
- This fixes precision issues with Discord snowflake IDs that exceed 2^53
- Ran lint: passed with only pre-existing warnings
- Typecheck: pre-existing errors unrelated to this change

[2026-01-22] Phase 1, Task 2: Reworked message pagination to fetch backwards with before:
- Modified: apps/controller/src/utils/messages.ts:44-87
- Changed from forward pagination (after:) to backward pagination (before:)
- Removed initial snowflake calculation and consecutive empty batches logic
- Added messages.reverse() to maintain chronological order
- Stops correctly when < 100 messages returned or timeframe exceeded
- Ran lint: passed with only pre-existing warnings

[2026-01-22] Phase 1, Task 3: Added max retry count to rate limit handling
- Modified: apps/controller/src/utils/messages.ts:44-97
- Added maxRetries constant (5) and retries counter
- Throws error after max retries exceeded instead of retrying forever
- Resets retry counter on successful fetch
- Ran lint: passed with only pre-existing warnings
- Phase 1 (Critical Fixes) now complete

[2026-01-22] Phase 2, Task 1: Cap embed description to Discord's 4096 character limit
- Modified: apps/controller/src/commands/summary.ts:77-91
- Truncates summary to 4090 chars and adds "... (truncated)" suffix if longer
- Prevents API errors when AI output exceeds Discord embed description limit
- Ran lint: passed with only pre-existing warnings

[2026-01-22] Phase 2, Task 2: Add max timeframe limit (7 days)
- Modified: apps/controller/src/commands/summary.ts:63-74
- Added MAX_TIMEFRAME_MS constant (7 days)
- Rejects with friendly error if timeframe exceeds 7 days
- Prevents timeouts and high costs from summarizing huge history
- Ran lint: passed with only pre-existing warnings

[2026-01-22] Phase 2, Task 3: Add max prompt size limit (50k characters)
- Modified: apps/controller/src/commands/summary.ts:76-84
- Added MAX_PROMPT_SIZE constant (50000)
- Truncates formatted messages and adds note if exceeds limit
- Prevents prompts that are too large for AI model context
- Ran lint: passed with only pre-existing warnings

[2026-01-22] Phase 2, Task 4: Suppress mention pings with allowedMentions
- Modified: apps/controller/src/commands/summary.ts:102-105
- Added allowedMentions: { parse: [] } to editReply call
- Prevents AI output from triggering @everyone, role, or user mentions
- Phase 2 (High Priority: Safety + UX) now complete
- Ran lint: passed with only pre-existing warnings

[2026-01-22] Phase 3, Task 1: Sanitize error messages shown to users
- Modified: apps/controller/src/commands/summary.ts:110-120
- Replaced error.message with generic user-facing message
- Error details still captured in Sentry for debugging
- Prevents leaking provider details or internal information to users
- Ran lint: passed with only pre-existing warnings
